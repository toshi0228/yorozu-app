import React, { useState, useContext } from 'react'
import { connect } from 'react-redux'
import { Modal, Button, Input } from 'antd'
import { planRequest } from '../../../../store/actions/plan'
import { sendMessage } from '../../../../store/actions/message'
import styles from './index.module.scss'

// ====================================================================
// プランリクエストのモーダル
// ====================================================================

const PlanContractModal = (props) => {
  console.log('planContractModal')
  console.log(props.planData)
  // プランリクエストする時のメッセージ
  const [requestMessage, setRequestMessage] = useState('')

  // ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝
  // requestDataは、プランのリクエストの時に必要な情報
  // ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝
  const requestData = {
    // リクエストの送り主(ログインしているユーザー)
    senderYorozuId: props.loginUserYorozuId,
    // リクエストの送り先のユーザー(プランオーナーのyorozuId)
    receiverYorozuId: props.planOwnerYorozuId,
  }
  // ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝
  // requestMessageDataは、モーダルに書き込んだテキストメッセージをプランオーナーに送る
  // ※プランオーナーは、メッセージをメッセージルームで確認することができる
  // ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝
  const requestMessageData = {
    // リクエストの送り主(ログインしているユーザー)
    senderYorozuId: props.loginUserYorozuId,
    // リクエストの送り先のユーザー(プランオーナーのyorozuId)
    receiverYorozuId: props.planOwnerYorozuId,
    messageContent: requestMessage,
  }

  // ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝
  // モーダルの中での送信ボタンを押した時の処理
  // ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝
  const hundleSubmit = () => {
    // プランのリクエストの処理
    props.planRequestEvent(requestData)
    // プランのリクエストした時のメッセージをプランオーナーに送信
    props.sendMessageEvent(requestMessageData)
    // 送信したら、メッセージのデータを初期化する
    setRequestMessage('')
    // 送信ボタンを押したらモダールを閉じる
    props.setIsPlanContractModalVisible(false)
  }

  // ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝
  // モーダルの中でのキャンセルボタンを押した時の処理
  // ＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝
  const handleCancel = () => {
    props.setIsPlanContractModalVisible(false)
  }

  return (
    <div>
      <Modal
        title="お支払い方法の選択"
        // visiblがtrueなら、モーダルが表示される
        visible={props.isPlanContractModalVisible}
        onOk={hundleSubmit}
        onCancel={handleCancel}
        footer={[
          <Button key="submit" onClick={hundleSubmit}>
            クレジットカードで決済
          </Button>,
        ]}
      >
        <h3>タイトル</h3>
        <p>{props.planData.title}</p>
        <h3>料金</h3>
        <p>{`${props.planData.price} 円`}</p>

        <h3>決済方法</h3>
        <p>クレジットカード</p>

        <h3>注意事項</h3>
        {/* <div style={{ marginBottom: 20 }} className={styles.attention}> */}
        <div style={{ marginBottom: 20 }}>
          <ul>
            <li>解約は自由に行なえますが、課金後の返金は行っておりません。</li>
          </ul>
          <ul>
            <li>毎月の契約は契約日から1ヶ月となります。例えば5/20に契約すると次回は6/20の更新となります。</li>
          </ul>
          <ul>
            <li>契約がつづく限り、毎月自動で課金が行われます。</li>
          </ul>
          <ul>
            <li>初回契約にかぎり、48時間以内によろずやから返答がない場合は自動キャンセル・返金となります。</li>
          </ul>
        </div>

        <p style={{ marginBottom: 10 }}></p>
      </Modal>
    </div>
  )
}

const mapStateToProps = (state) => ({
  // リクエストの送り主(ログインしているユーザー)
  loginUserYorozuId: state.account.yorozuId,
  // リクエストの送り先のユーザー(プランオーナーのyorozuId)
  planOwnerYorozuId: state.profile.profileDetail.yorozuId,
})

const mapStateToDispatch = (dispatch) => ({
  // プランのリクエストを送るアクション
  planRequestEvent: (requestData) => dispatch(planRequest(requestData)),
  // プランリクエストのメッセージを送る処理
  sendMessageEvent: (messageData) => dispatch(sendMessage(messageData)),
})

export default connect(mapStateToProps, mapStateToDispatch)(PlanContractModal)
